package com.sdzee.servlets;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
//https://openclassrooms.com/fr/courses/626954-creez-votre-application-web-avec-java-ee/619584-la-servlet
public class Test extends HttpServlet {
	private static final int DEFAULT_BUFFER_SIZE = 10240; // 10 ko
	public void doGet( HttpServletRequest request, HttpServletResponse response ) throws ServletException, IOException{
		/*response.setContentType("text/html");
		response.setCharacterEncoding( "UTF-8" );
		PrintWriter out = response.getWriter();
		out.println("<!DOCTYPE html>");
		out.println("<html>");
		out.println("<head>");
		out.println("<meta charset=\"utf-8\" />");
		out.println("<title>Test</title>");
		out.println("</head>");
		out.println("<body>");
		out.println("<p>Ceci est une page générée depuis une servlet.</p>");
		out.println("</body>");
		out.println("</html>");*/
		
		//traitement de la demande
		if(false) {
			/* Si non, alors on envoie une erreur 404, qui signifie que la ressource demandée n'existe pas */
		    response.sendError(HttpServletResponse.SC_NOT_FOUND);
		    return;
		}
		
		/* Initialise la réponse HTTP */
		response.reset();
		response.setBufferSize( DEFAULT_BUFFER_SIZE );
		String  type = "application/octet-stream";
		response.setContentType( type );
		String data=" hello joli gars !";
		response.setHeader( "Content-Length", new String(data.length()) );
		response.setHeader( "Content-Disposition", "attachment; filename=\"" + fichier.getName() + "\"" );
		/* Prépare les flux */
		BufferedInputStream entree = null;
		BufferedOutputStream sortie = null;
		try {
		    /* Ouvre les flux */
		    entree = new BufferedInputStream( new FileInputStream( fichier ), TAILLE_TAMPON );
		    sortie = new BufferedOutputStream( response.getOutputStream(), TAILLE_TAMPON );
		 
		    /* ... */
		} finally {
		    try {
		        sortie.close();
		    } catch ( IOException ignore ) {
		    }
		    try {
		        entree.close();
		    } catch ( IOException ignore ) {
		    }
		}
		/* Lit le fichier et écrit son contenu dans la réponse HTTP */
		byte[] tampon = new byte[TAILLE_TAMPON];
		int longueur;
		while ( ( longueur= entree.read( tampon ) ) > 0 ) {
		    sortie.write( tampon, 0, longueur );
		}
	}
}